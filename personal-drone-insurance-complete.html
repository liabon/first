<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê²¬ì ì„œ í™•ì¸ - KBì†í•´ë³´í—˜ ê°œì¸ìš© ë“œë¡ ë³´í—˜</title>

  <!-- í°íŠ¸ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root{
      --kb-yellow:#FFCD00;
      --kb-gold:#FFB800;
      --kb-dark:#1a1a1a;
    }

    body{
      font-family:'Noto Sans KR', sans-serif;
      color:var(--kb-dark);
      line-height:1.6;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    header{ background:#fff; box-shadow:0 2px 10px rgba(0,0,0,0.05); }
    .header-content{
      max-width:1200px; margin:0 auto; padding:1.5rem 2rem;
      display:flex; justify-content:space-between; align-items:center;
    }
    .logo-section{ display:flex; align-items:center; gap:1.5rem; }
    .kb-logo{ height:50px; }
    .divider{ height:40px; width:1px; background:#ddd; }
    .agency-name{ font-size:1.5rem; font-weight:700; color:var(--kb-dark); }

    .main-content{
      flex:1; display:flex; align-items:center; justify-content:center;
      padding:3rem 2rem;
    }

    .complete-card{
      background:#fff; border-radius:30px;
      padding:4rem 3rem; max-width:800px; width:100%;
      box-shadow:0 20px 60px rgba(0,0,0,0.3);
    }

    .title-section{ text-align:center; margin-bottom:3rem; }
    .success-icon{
      width:80px; height:80px; background:var(--kb-gold);
      border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      margin:0 auto 1.5rem; font-size:2.5rem;
    }
    .complete-title{ font-size:2rem; font-weight:900; margin-bottom:0.5rem; color:var(--kb-dark); }
    .complete-subtitle{ font-size:1rem; color:#666; }

    .quote-box{
      background:#f8f9fa; border-radius:15px;
      padding:2rem; margin-bottom:2rem;
    }
    .quote-title{ font-size:1.3rem; font-weight:700; margin-bottom:1.5rem; color:var(--kb-gold); }

    .info-row{
      display:flex; justify-content:space-between;
      padding:0.8rem 0;
      border-bottom:1px solid #e0e0e0;
      gap:1rem;
    }
    .info-row:last-child{ border-bottom:none; }
    .info-label{ font-weight:600; color:#666; }
    .info-value{ font-weight:700; color:var(--kb-dark); text-align:right; word-break:break-word; }

    .total-price{
      background:var(--kb-gold);
      padding:1.5rem; border-radius:12px;
      text-align:center; margin:2rem 0;
    }
    .total-price-label{ font-size:1rem; margin-bottom:0.5rem; }
    .total-price-value{ font-size:2.5rem; font-weight:900; color:var(--kb-dark); }

    .action-buttons{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:1rem; margin-bottom:1.5rem;
    }
    .btn{
      padding:1.2rem; border:none; border-radius:12px;
      font-size:1.1rem; font-weight:700;
      cursor:pointer; transition:all 0.3s;
    }
    .btn-pdf{ background:#e74c3c; color:#fff; }
    .btn-pdf:hover{ background:#c0392b; transform:translateY(-2px); }

    .btn-email{ background:var(--kb-gold); color:var(--kb-dark); }
    .btn-email:hover{ background:var(--kb-yellow); transform:translateY(-2px); }

    .navigation-buttons{
      display:grid;
      grid-template-columns:1fr 2fr;
      gap:1rem;
    }
    .btn-back{ background:#e0e0e0; color:var(--kb-dark); }
    .btn-back:hover{ background:#d0d0d0; }
    .btn-payment{ background:var(--kb-dark); color:#fff; }
    .btn-payment:hover{ background:#000; transform:translateY(-2px); }

    .notice{
      background:#fff9e6;
      padding:1.5rem; border-radius:12px;
      margin-top:2rem;
      font-size:0.95rem; color:#666;
    }
    .notice strong{ color:var(--kb-dark); display:block; margin-bottom:0.5rem; }

    footer{ background:var(--kb-dark); color:#fff; padding:2rem; }
    .footer-content{
      max-width:1200px; margin:0 auto;
      text-align:center; font-size:0.9rem; opacity:0.8;
    }

    @media (max-width:768px){
      .complete-card{ padding:3rem 2rem; }
      .action-buttons, .navigation-buttons{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
  <header>
    <div class="header-content">
      <div class="logo-section">
        <img src="kb-logo.png" alt="KBì†í•´ë³´í—˜" class="kb-logo">
        <div class="divider"></div>
        <div class="agency-name">ë°°ìƒì˜¨ ëŒ€ë¦¬ì </div>
      </div>
    </div>
  </header>

  <div class="main-content">
    <div class="complete-card">
      <div class="title-section">
        <div class="success-icon">ğŸ“‹</div>
        <h1 class="complete-title">ê²¬ì ì„œ í™•ì¸</h1>
        <p class="complete-subtitle">ì…ë ¥í•˜ì‹  ì •ë³´ë¥¼ í™•ì¸í•˜ì‹œê³  ê²¬ì ì„œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ì´ë©”ì¼ë¡œ ë°›ì•„ë³´ì„¸ìš”</p>
      </div>

      <div class="quote-box">
        <h2 class="quote-title">ë³´í—˜ ì •ë³´</h2>
        <div id="insuranceInfo"></div>
      </div>

      <div class="total-price">
        <div class="total-price-label">ì´ ë³´í—˜ë£Œ</div>
        <div class="total-price-value" id="totalPrice">0ì›</div>
      </div>

      <div class="action-buttons">
        <button class="btn btn-pdf" onclick="downloadPDF()">ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ</button>
        <button class="btn btn-email" onclick="sendEmail()">ğŸ“§ ì´ë©”ì¼ ì „ì†¡</button>
      </div>

      <div class="navigation-buttons">
        <button class="btn btn-back" onclick="history.back()">ì´ì „</button>
        <button class="btn btn-payment" onclick="alert('ê²°ì œ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')">ê²°ì œí•˜ê¸°</button>
      </div>

      <div class="notice">
        <strong>ì•ˆë‚´ì‚¬í•­</strong>
        â€¢ ê²¬ì ì„œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ì´ë©”ì¼ë¡œ ë°›ì•„ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
        â€¢ ê°€ì…ì„ ì›í•˜ì‹œë©´ ê²°ì œí•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br>
        â€¢ ê²¬ì ì„œëŠ” ì°¸ê³ ìš©ì´ë©°, ìµœì¢… ë³´í—˜ë£ŒëŠ” ì‹¬ì‚¬ í›„ í™•ì •ë©ë‹ˆë‹¤.<br>
        â€¢ ë¬¸ì˜ì‚¬í•­: liab.on.ins@gmail.com
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-content">
      <p>Â© 2026 ë°°ìƒì˜¨ ëŒ€ë¦¬ì . All rights reserved. | KBì†í•´ë³´í—˜ ê³µì‹ ëŒ€ë¦¬ì </p>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    let insuranceData = null;

    const droneTypes = {
      camera: 'ì´¬ì˜ìš© ì„¼ì„œë“œë¡ ',
      fpv: 'FPV/ë ˆì´ì‹± ë“œë¡ ',
      toy: 'ì™„êµ¬í˜• ë“œë¡ ',
      other: 'ê¸°íƒ€ ë“œë¡ '
    };

    function safeText(v, fallback = '-') {
      if (v === null || v === undefined) return fallback;
      const s = String(v).trim();
      return s.length ? s : fallback;
    }

    function money(v, fallback = '-') {
      const n = Number(v);
      if (!Number.isFinite(n)) return fallback;
      return n.toLocaleString() + 'ì›';
    }

    window.addEventListener('DOMContentLoaded', () => {
      const savedData = sessionStorage.getItem('droneInsuranceData');
      if (!savedData) {
        alert('ì €ì¥ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        window.location.href = '/personal-drone-insurance';
        return;
      }
      try {
        insuranceData = JSON.parse(savedData);
      } catch (e) {
        console.error(e);
        alert('ì €ì¥ëœ ì •ë³´ê°€ ì†ìƒë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        window.location.href = '/personal-drone-insurance';
        return;
      }
      displayInfo();
    });

    function displayInfo() {
      const container = document.getElementById('insuranceInfo');

      const typeLabel = droneTypes[insuranceData.drone_type] || droneTypes.other;

      const html = `
        <div class="info-row">
          <span class="info-label">ê°€ì…ìëª…</span>
          <span class="info-value">${safeText(insuranceData.name)}</span>
        </div>
        <div class="info-row">
          <span class="info-label">ì—°ë½ì²˜</span>
          <span class="info-value">${safeText(insuranceData.phone)}</span>
        </div>
        <div class="info-row">
          <span class="info-label">ì´ë©”ì¼</span>
          <span class="info-value">${safeText(insuranceData.email)}</span>
        </div>
        <div class="info-row">
          <span class="info-label">ë³´í—˜ê¸°ê°„</span>
          <span class="info-value">${safeText(insuranceData.insurance_start)} ~ ${safeText(insuranceData.insurance_end)}</span>
        </div>
        <div class="info-row">
          <span class="info-label">ë“œë¡  ì¢…ë¥˜</span>
          <span class="info-value">${safeText(typeLabel)}</span>
        </div>
        <div class="info-row">
          <span class="info-label">ë“œë¡  ëŒ€ìˆ˜</span>
          <span class="info-value">${safeText(insuranceData.drone_count, '0')}ëŒ€</span>
        </div>
        <div class="info-row">
          <span class="info-label">ì„ íƒ í”Œëœ</span>
          <span class="info-value">${safeText(insuranceData.plan_name)}</span>
        </div>
        <div class="info-row">
          <span class="info-label">ë³´í—˜ë£Œ(1ëŒ€ë‹¹)</span>
          <span class="info-value">${money(insuranceData.plan_price_per_drone, '-')} /ë…„</span>
        </div>
      `;

      container.innerHTML = html;

      const total = money(insuranceData.plan_total_price, '0ì›');
      document.getElementById('totalPrice').textContent = total;
    }

    function getCoverageInfo(plan) {
      const p = safeText(plan, '').toLowerCase();
      const coverage = { personal: 'ë¯¸ì…ë ¥', property: 'ë¯¸ì…ë ¥', additional: 'ë¯¸ì…ë ¥' };

      if (!p) return coverage;

      if (p.includes('slim')) {
        coverage.personal = '50,000,000ì›';
        coverage.property = '50,000,000ì›';
      } else if (p.includes('standard')) {
        coverage.personal = '100,000,000ì›';
        coverage.property = '100,000,000ì›';
      } else if (p.includes('premium')) {
        coverage.personal = '500,000,000ì›';
        coverage.property = '500,000,000ì›';
      }

      const isCamera = p.includes('camera');
      const isFpv = p.includes('fpv');

      if (isCamera) {
        if (p.includes('slim')) coverage.additional = 'ê¸°ë³¸ì¶©ì‹¤';
        else if (p.includes('standard')) coverage.additional = 'ëˆ„êµ¬ë‚˜ìš´ì „ í¬í•¨';
        else if (p.includes('premium')) coverage.additional = 'ëˆ„êµ¬ë‚˜ìš´ì „ + êµ¬ì¡°ë¹„ìš©';
      } else if (isFpv) {
        if (p.includes('slim')) coverage.additional = 'ë“œë¡ ê²½ê¸°ì¤‘ ë³´ì¥';
        else if (p.includes('standard')) coverage.additional = 'ë“œë¡ ê²½ê¸°ì¤‘ + ëˆ„êµ¬ë‚˜ìš´ì „';
        else if (p.includes('premium')) coverage.additional = 'ë“œë¡ ê²½ê¸°ì¤‘ + ëˆ„êµ¬ë‚˜ìš´ì „ + êµ¬ì¡°ë¹„ìš©';
      } else {
        if (p.includes('slim')) coverage.additional = 'ê¸°ë³¸ ë³´ì¥';
        else if (p.includes('standard')) coverage.additional = 'ëˆ„êµ¬ë‚˜ìš´ì „ í¬í•¨';
        else if (p.includes('premium')) coverage.additional = 'ëˆ„êµ¬ë‚˜ìš´ì „ + êµ¬ì¡°ë¹„ìš©';
      }

      return coverage;
    }

    // âœ… í°íŠ¸/ì´ë¯¸ì§€ ë¡œë“œ ëŒ€ê¸° (PDF ê³µë°± ë¬¸ì œ í•µì‹¬ í•´ê²°)
    function waitForImages(el) {
      const imgs = Array.from(el.querySelectorAll('img'));
      if (imgs.length === 0) return Promise.resolve();

      return Promise.all(imgs.map(img => {
        if (img.complete && img.naturalWidth > 0) return Promise.resolve();
        return new Promise(resolve => {
          img.onload = () => resolve();
          img.onerror = () => resolve(); // ë¡œê³ ê°€ ê¹¨ì ¸ë„ PDF ìì²´ëŠ” ë§Œë“¤ê²Œ
        });
      }));
    }

    async function downloadPDF() {
      if (!insuranceData) {
        alert('ê²¬ì  ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const typeLabel = droneTypes[insuranceData.drone_type] || droneTypes.other;

      const today = new Date();
      const dateStr = `${today.getFullYear()}. ${String(today.getMonth() + 1)}. ${String(today.getDate())}.`;

      let dronesHTML = '';
      if (Array.isArray(insuranceData.drones) && insuranceData.drones.length > 0) {
        dronesHTML = insuranceData.drones.map((drone, i) => `
          <div style="border-left:3px solid #FFB800; padding-left:12px; margin:10px 0;">
            <p style="margin:5px 0; font-size:12px; font-weight:700;">ë“œë¡  ${i + 1}:</p>
            <p style="margin:3px 0; font-size:11px;">ëª¨ë¸ëª…: ${safeText(drone.model, 'ë¯¸ì…ë ¥')}</p>
            <p style="margin:3px 0; font-size:11px;">ì‹œë¦¬ì–¼ë²ˆí˜¸: ${safeText(drone.serial, 'ë¯¸ì…ë ¥')}</p>
            <p style="margin:3px 0; font-size:11px;">ìì²´ì¤‘ëŸ‰: ${safeText(drone.weight, 'ë¯¸ì…ë ¥')}kg</p>
            <p style="margin:3px 0; font-size:11px;">ìµœëŒ€ì´ë¥™ì¤‘ëŸ‰: ${safeText(drone.max_weight, 'ë¯¸ì…ë ¥')}kg</p>
          </div>
        `).join('');
      }

      const coverage = getCoverageInfo(insuranceData.plan);

      // PDFìš© DOMì„ ì‹¤ì œë¡œ ë¶™ì˜€ë‹¤ê°€ ì œê±° (ë Œë” ì•ˆì •í™”)
      const element = document.createElement('div');
      element.style.width = '210mm';
      element.style.background = '#fff';
      element.style.fontFamily = "'Noto Sans KR', sans-serif";
      element.style.position = 'fixed';
      element.style.left = '-9999px';
      element.style.top = '0';
      element.style.zIndex = '-1';

      // í°íŠ¸ importë¥¼ PDF DOM ë‚´ë¶€ì—ë„ í•œë²ˆ ë”(ì•ˆì •ì„±)
      element.innerHTML = `
        <style>
          @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
          * { box-sizing: border-box; }
        </style>

        <div style="background:linear-gradient(135deg,#FFB800 0%,#FFCD00 100%); padding:30px; text-align:center;">
          <h1 style="color:#1a1a1a; margin:0; font-size:24px; font-weight:900;">KBì†í•´ë³´í—˜ ê°œì¸ìš© ë“œë¡ ë³´í—˜</h1>
          <h2 style="color:#1a1a1a; margin:8px 0 0 0; font-size:18px; font-weight:700;">ê²¬ì ì„œ</h2>
        </div>

        <div style="padding:20px 30px;">
          <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:15px;">
            <h3 style="color:#FFB800; font-size:14px; font-weight:700; margin:0 0 10px 0;">ğŸ“‹ ê²¬ì  ì •ë³´</h3>
            <p style="margin:4px 0; font-size:12px;"><strong>ê²¬ì ì¼ì:</strong> ${dateStr}</p>
            <p style="margin:4px 0; font-size:12px;"><strong>ë³´í—˜ê¸°ê°„:</strong> ${safeText(insuranceData.insurance_start)} ~ ${safeText(insuranceData.insurance_end)}</p>
            <p style="margin:4px 0; font-size:12px;"><strong>ìƒí’ˆëª…:</strong> KBì†í•´ë³´í—˜ ê°œì¸ìš© ë“œë¡ ë³´í—˜</p>
          </div>

          <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:15px;">
            <h3 style="color:#FFB800; font-size:14px; font-weight:700; margin:0 0 10px 0;">ğŸ‘¤ ê³ ê° ì •ë³´</h3>
            <p style="margin:4px 0; font-size:12px;"><strong>ì´ë¦„:</strong> ${safeText(insuranceData.name)}</p>
            <p style="margin:4px 0; font-size:12px;"><strong>ì—°ë½ì²˜:</strong> ${safeText(insuranceData.phone)}</p>
            <p style="margin:4px 0; font-size:12px;"><strong>ì´ë©”ì¼:</strong> ${safeText(insuranceData.email)}</p>
          </div>

          <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:15px;">
            <h3 style="color:#FFB800; font-size:14px; font-weight:700; margin:0 0 10px 0;">ğŸš ë“œë¡  ì •ë³´</h3>
            <p style="margin:4px 0; font-size:12px;"><strong>ë“œë¡  ì¢…ë¥˜:</strong> ${safeText(typeLabel)}</p>
            <p style="margin:4px 0; font-size:12px;"><strong>ë“œë¡  ëŒ€ìˆ˜:</strong> ${safeText(insuranceData.drone_count, '0')}ëŒ€</p>
            ${dronesHTML}
          </div>

          <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:15px;">
            <h3 style="color:#FFB800; font-size:14px; font-weight:700; margin:0 0 10px 0;">ğŸ’° ë³´ì¥ ë‚´ìš©</h3>
            <p style="margin:4px 0 10px 0; font-size:12px;"><strong>ì„ íƒ í”Œëœ:</strong> ${safeText(insuranceData.plan_name)}</p>
            <div style="border-left:3px solid #FFB800; padding-left:12px; margin:10px 0;">
              <p style="margin:4px 0; font-size:12px;"><strong>ëŒ€ì¸ë°°ìƒ:</strong> ${safeText(coverage.personal)}</p>
              <p style="margin:4px 0; font-size:12px;"><strong>ëŒ€ë¬¼ë°°ìƒ:</strong> ${safeText(coverage.property)}</p>
              <p style="margin:4px 0; font-size:12px;"><strong>ê¸°ë³¸ë³´ì¥:</strong> ${safeText(coverage.additional)}</p>
            </div>
            <p style="margin:10px 0 4px 0; font-size:12px;"><strong>ìê¸°ë¶€ë‹´ê¸ˆ:</strong> 100,000ì›</p>
          </div>

          <div style="background:#FFB800; padding:20px; border-radius:8px; text-align:center; margin-bottom:15px;">
            <p style="margin:0 0 6px 0; font-size:13px; font-weight:600;">ì—°ê°„ ë³´í—˜ë£Œ</p>
            <p style="margin:0; font-size:32px; font-weight:900;">${money(insuranceData.plan_total_price, '0ì›')}</p>
            <p style="margin:6px 0 0 0; font-size:13px;">1ëŒ€ë‹¹ ${money(insuranceData.plan_price_per_drone, '-')}</p>
          </div>

          <div style="background:#fff9e6; padding:12px; border-radius:8px; font-size:11px;">
            <p style="margin:0 0 4px 0; font-weight:700;">ìœ ì˜ì‚¬í•­</p>
            <p style="margin:3px 0;">â€» êµ¬ì²´ì ì¸ ë³´ì¥/ë©´ì±… ë° ë³´í—˜ê¸ˆ ì§€ê¸‰ì€ ì•½ê´€ì— ë”°ë¦…ë‹ˆë‹¤.</p>
            <p style="margin:3px 0;">â€» ë³¸ ê²¬ì ì„œëŠ” ì°¸ê³ ìš©ì´ë©°, ìµœì¢… ë³´í—˜ë£ŒëŠ” ì‹¬ì‚¬ í›„ í™•ì •ë©ë‹ˆë‹¤.</p>
          </div>
        </div>

        <div style="background:#1a1a1a; color:#fff; padding:20px; text-align:center;">
          <p style="margin:0; font-size:14px; font-weight:700;">ë°°ìƒì˜¨ ëŒ€ë¦¬ì </p>
          <p style="margin:6px 0; font-size:12px;">ğŸ“§ liab.on.ins@gmail.com | ğŸŒ www.liab.co.kr</p>
          <p style="margin:6px 0 0 0; font-size:11px; opacity:0.7;">KBì†í•´ë³´í—˜ ê³µì‹ ëŒ€ë¦¬ì </p>
        </div>
      `;

      document.body.appendChild(element);

      try {
        // í°íŠ¸ ë¡œë“œ ì™„ë£Œ ëŒ€ê¸° (ê³µë°± ë°©ì§€)
        if (document.fonts && document.fonts.ready) {
          await document.fonts.ready;
        }
        // ì´ë¯¸ì§€ ë¡œë“œ ëŒ€ê¸° (í•„ìš” ì‹œ)
        await waitForImages(element);

        const y = String(today.getFullYear());
        const m = String(today.getMonth() + 1).padStart(2, '0');
        const d = String(today.getDate()).padStart(2, '0');

        const opt = {
          margin: 0,
          filename: `KB_ë“œë¡ ë³´í—˜_ê²¬ì ì„œ_${safeText(insuranceData.name, 'ê³ ê°')}_${y}${m}${d}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: {
            scale: 2,
            useCORS: true,
            allowTaint: true,
            letterRendering: true
          },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        await html2pdf().set(opt).from(element).save();
      } catch (error) {
        console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
        alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        element.remove();
      }
    }

    async function sendEmail() {
      if (!insuranceData) {
        alert('ê²¬ì  ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      try {
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            ...insuranceData,
            insurance_type: 'ê°œì¸ìš© ë“œë¡ ë³´í—˜',
            request_type: 'quote_email',
            send_to_customer: true
          })
        });

        if (response.ok) {
          alert(`ê²¬ì ì„œê°€ ${safeText(insuranceData.email)}ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        } else {
          const text = await response.text().catch(() => '');
          console.error('Email API error:', response.status, text);
          alert('ì´ë©”ì¼ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ì´ë©”ì¼ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
  </script>
</body>
</html>
